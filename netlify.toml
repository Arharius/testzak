[build]
  base    = "."
  publish = "frontend-react/dist"
  command = "NETLIFY=1 npm run build --prefix frontend-react"

[build.environment]
  NODE_VERSION = "20"
  VITE_BACKEND_URL = "https://backend-production-f736.up.railway.app"
  BACKEND_API_BASE_URL = "https://backend-production-f736.up.railway.app"

# Unified API on the same Netlify domain (frontend -> backend service).
[[redirects]]
  from   = "/api/ai/generate"
  to     = "/.netlify/functions/ai-generate"
  status = 200
  force  = true

[[redirects]]
  from   = "/api/search/specs"
  to     = "/.netlify/functions/search-specs"
  status = 200
  force  = true

[[redirects]]
  from   = "/api/search/eis"
  to     = "/.netlify/functions/search-eis"
  status = 200
  force  = true

[[redirects]]
  from   = "/api/*"
  to     = "/.netlify/functions/backend-proxy/:splat"
  status = 200
  force  = true

# Proxy to zakupki.gov.ru for React EIS context fetcher (same-origin from browser).
[[redirects]]
  from   = "/proxy/zakupki/*"
  to     = "https://zakupki.gov.ru/:splat"
  status = 200
  force  = true

[[redirects]]
  from   = "/*"
  to     = "/index.html"
  status = 200
